package ParkingLotGUI;

import javafx.application.Application;
import javafx.event.ActionEvent;
import javafx.event.EventHandler;
import javafx.geometry.Insets;
import javafx.geometry.Pos;
import javafx.scene.Scene;
import javafx.scene.control.Button;
import javafx.scene.control.Label;
import javafx.scene.control.ListView;
import javafx.scene.control.RadioButton;
import javafx.scene.control.TextField;
import javafx.scene.layout.GridPane;
import javafx.stage.Stage;
import parkingLotSystem.Car;
import parkingLotSystem.ParkingLot;
import parkingLotSystem.Truck;
import parkingLotSystem.Vehicle;

public class ParkingLotApp extends Application {

	/**
	*  ParkingLotApp javafx application gives the user a platform to store information
	*  about customers who wants to park, while giving feedback information regarding the
	*  work order.
	*  . 	Including:
	*  - A (4-7 character) License plate
	*  - Customer requested number of hours of parking time.
	*  - Storing vehicle as either a Truck (set to $30 hourly) or a Car (set to $15 hourly)
	*  - Assigns customer to corresponding parking lot number. NOT ADDED *
	*  - Calculating the final bill amount $.
	*  - Time of parking permit expiration.
	*
	*   @see <A HREF="..application/ParkingLotApp.java"> Java Source Code
	*   (www.sunysuffolk.edu/nickdimonti/application/ParkingLotApp.java)
	*
	*   @author dimon71 <A HREF="mailto:dimon71@sunysuffolk.edu"> (dimon71@sunysuffolk.edu) </A>
	*
	*   @version October 9, 2017
	*
	*   **/

	ParkingLot theParkingLot = new ParkingLot();

	@Override
	public void start(Stage primaryStage) {

		primaryStage.setTitle("Parking Garage Manager");

		GridPane gridPane = new GridPane();
		Scene scene = new Scene(gridPane, 700, 500);
		gridPane.setAlignment(Pos.CENTER);
        gridPane.setHgap(20);
        gridPane.setVgap(20);
        gridPane.setPadding(new Insets(20, 20, 20, 20));


        // Add Vehicle button
        Button addVehicleBtn = new Button("Add Vehicle");
        addVehicleBtn.setPrefWidth(150);
        addVehicleBtn.setAlignment(Pos.CENTER);
        gridPane.add(addVehicleBtn, 0, 0);

        // Cancel Vehicle button
        Button cancelVehicleBtn = new Button("Cancel Vehicle");
        cancelVehicleBtn.setPrefWidth(150);
        cancelVehicleBtn.setAlignment(Pos.CENTER);
        gridPane.add(cancelVehicleBtn, 1, 0);


        // License Plate label and text field
        Label licensePlateLbl = new Label("License Plate: ");
        gridPane.add(licensePlateLbl, 0, 1);
        TextField licensePlateField = new TextField();
        licensePlateField.setPromptText("Enter plate # to Cancel Vehicle (4-7 characters)");
        gridPane.add(licensePlateField, 1, 1);


        // Amount of parking time requested label and text field
        Label timeRequestedLbl = new Label("Time Requested: ");
        gridPane.add(timeRequestedLbl, 0, 2);
        TextField timeRequestedField = new TextField();
        timeRequestedField.setPromptText("hourly (1-72)");
        gridPane.add(timeRequestedField, 1, 2);


        // Car or Truck radio button
        RadioButton isATruckRb = new RadioButton("Vehicle is a Truck");
        gridPane.add(isATruckRb, 0, 3);

        // List of parked Vehicles by License plate
        ListView vehicleList = new ListView();
        gridPane.add(vehicleList, 1, 3);
        vehicleList.setPrefWidth(450);



        // Action event for new vehicle button (created new vehicle then adds it to the lot)
        addVehicleBtn.setOnAction(new EventHandler<ActionEvent>() {
            @Override
            public void handle(ActionEvent e) {
            	if(!licensePlateField.getText().isEmpty() && licensePlateField.getText() != null
            			&& isATruckRb.isSelected() && !timeRequestedField.getText().isEmpty() &&
            			timeRequestedField.getText() != null && licensePlateField.getText().length() >= 4 &&
            			licensePlateField.getText().length() <= 7 && Double.parseDouble(timeRequestedField.getText())
            			< 72 && Double.parseDouble(timeRequestedField.getText()) >= 1){
            		String licensePlate = licensePlateField.getText();
            		double requestedParkingTime = Double.parseDouble(timeRequestedField.getText());
            		Truck newTruck = new Truck(licensePlate, requestedParkingTime);
            		theParkingLot.getVehicleParkingSpots().add(newTruck);
            		vehicleList.getItems().add(newTruck);
            		licensePlateField.clear();
            		timeRequestedField.clear();
            		isATruckRb.setSelected(false); //unselect truck button
            	} else if (!licensePlateField.getText().isEmpty() && licensePlateField.getText() != null
            			&& !isATruckRb.isSelected() && !timeRequestedField.getText().isEmpty() &&
            			timeRequestedField.getText() != null && licensePlateField.getText().length() >= 4 &&
            			licensePlateField.getText().length() <= 7 && Double.parseDouble(timeRequestedField.getText())
            			< 72 && Double.parseDouble(timeRequestedField.getText()) >= 1){
            		String licensePlate = licensePlateField.getText();
            		double requestedParkingTime = Double.parseDouble(timeRequestedField.getText());
            		Car newCar = new Car(licensePlate, requestedParkingTime);
            		theParkingLot.getVehicleParkingSpots().add(newCar);
            		vehicleList.getItems().add(newCar);
            		licensePlateField.clear();
            		timeRequestedField.clear();
            	}
        	}
        });


        // Action event for canceling a vehicle (deletes vehicle from list view and hashSet)
        cancelVehicleBtn.setOnAction(new EventHandler<ActionEvent>() {
       		@Override
        	public void handle(ActionEvent e) {
       			if(!licensePlateField.getText().isEmpty() && licensePlateField.getText() != null){
            		String licensePlate = licensePlateField.getText();
            		Vehicle vehicle = findVehicleByLicensePlate(licensePlate);
            		theParkingLot.getVehicleParkingSpots().remove(vehicle);
					vehicleList.getItems().remove(vehicle);
            		licensePlateField.clear();
            	}
        	}
        });


        primaryStage.setScene(scene);
        primaryStage.show();
	}


	public static void main(String[] args) {
		launch(args);
	}


	public Vehicle findVehicleByLicensePlate(String licensePlate){
		for(Vehicle v : theParkingLot.getVehicleParkingSpots()){
			if(v.licensePlate.equals(licensePlate)){
				return v;
			}
		}
		return null;
	}

	/*
	// TEST METHOD: DISPLAY theParkingLot.getVehicleParkingSpots()
	public void displayVehiclesInHashSet(){
		for(Vehicle v : theParkingLot.getVehicleParkingSpots()){
			System.out.println(v.toString());
		}
	}
	*/

	}


